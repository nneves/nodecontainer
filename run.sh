#!/bin/bash
#
# Run node.js in a container
#
#

set -e

#NODE_VERSION="latest"
#NODE_VERSION="7"
#NODE_VERSION="7.3"
#NODE_VERSION="7.3.0"
#NODE_VERSION="6"
#NODE_VERSION="6.9"
#NODE_VERSION="6.9.2"
#NODE_VERSION="4"
#NODE_VERSION="4.7"
#NODE_VERSION="4.7.0"
#NODE_VERSION="0.12"
#NODE_VERSION="0.12.18"
NODE_VERSION="0.10"
#NODE_VERSION="0.10.48"

#NPM_VERSION="1.1.25"
#NPM_VERSION="1.2.32"
#NPM_VERSION="1.3.2"
#NPM_VERSION="1.3.4"
#NPM_VERSION="1.2.20"
#NPM_VERSION="1.2.21"
#NPM_VERSION="1.2.22"
#NPM_VERSION="1.2.23"
#NPM_VERSION="1.2.24"
#NPM_VERSION="1.2.25"
#NPM_VERSION="1.2.27"
#NPM_VERSION="1.2.28"
#NPM_VERSION="1.2.30"
#NPM_VERSION="1.2.31"
#NPM_VERSION="1.3.0"
#NPM_VERSION="1.3.1"
#NPM_VERSION="1.2.19"
#NPM_VERSION="1.1.70"
#NPM_VERSION="1.1.71"
#NPM_VERSION="1.3.5"
#NPM_VERSION="1.3.6"
#NPM_VERSION="1.3.7"
#NPM_VERSION="1.3.8"
#NPM_VERSION="1.3.9"
#NPM_VERSION="1.3.10"
#NPM_VERSION="1.3.11"
#NPM_VERSION="1.3.12"
#NPM_VERSION="1.3.13"
#NPM_VERSION="1.3.14"
#NPM_VERSION="1.3.15"
#NPM_VERSION="1.3.16"
#NPM_VERSION="1.3.17"
#NPM_VERSION="1.3.18"
#NPM_VERSION="1.3.20"
#NPM_VERSION="1.3.21"
#NPM_VERSION="1.3.22"
#NPM_VERSION="1.3.23"
#NPM_VERSION="1.3.24"
#NPM_VERSION="1.3.25"
#NPM_VERSION="1.3.26"
#NPM_VERSION="1.4.0"
#NPM_VERSION="1.4.1"
#NPM_VERSION="1.4.2"
#NPM_VERSION="1.4.3"
#NPM_VERSION="1.4.4"
#NPM_VERSION="1.4.5"
#NPM_VERSION="1.4.6"
#NPM_VERSION="1.4.7"
#NPM_VERSION="1.4.8"
#NPM_VERSION="1.4.9"
#NPM_VERSION="1.4.10"
#NPM_VERSION="1.4.11"
#NPM_VERSION="1.4.12"
#NPM_VERSION="1.4.13"
#NPM_VERSION="1.4.14"
#NPM_VERSION="1.4.15"
#NPM_VERSION="1.4.16"
#NPM_VERSION="1.2.8000"
#NPM_VERSION="1.4.17"
#NPM_VERSION="1.4.18"
#NPM_VERSION="1.4.19"
#NPM_VERSION="1.5.0-alpha-0"
#NPM_VERSION="1.5.0-alpha-1"
#NPM_VERSION="1.4.20"
#NPM_VERSION="1.5.0-alpha-2"
#NPM_VERSION="1.4.21"
#NPM_VERSION="1.5.0-alpha-3"
#NPM_VERSION="1.5.0-alpha-4"
#NPM_VERSION="2.0.0-alpha-5"
#NPM_VERSION="1.4.22"
#NPM_VERSION="1.4.23"
#NPM_VERSION="2.0.0-alpha.6.0"
#NPM_VERSION="1.4.24"
#NPM_VERSION="2.0.0-alpha.6"
#NPM_VERSION="2.0.0-alpha.7"
#NPM_VERSION="2.0.0-beta.0"
#NPM_VERSION="1.4.25"
#NPM_VERSION="2.0.0-beta.1"
#NPM_VERSION="1.4.26"
#NPM_VERSION="2.0.0-beta.2"
#NPM_VERSION="1.4.27"
#NPM_VERSION="2.0.0-beta.3"
#NPM_VERSION="1.4.28"
#NPM_VERSION="2.0.0"
#NPM_VERSION="2.0.1"
#NPM_VERSION="2.0.2"
#NPM_VERSION="2.1.0"
#NPM_VERSION="2.1.1"
#NPM_VERSION="2.1.2"
#NPM_VERSION="2.1.3"
#NPM_VERSION="2.1.4"
#NPM_VERSION="2.1.5"
#NPM_VERSION="2.1.6"
#NPM_VERSION="2.1.7"
#NPM_VERSION="2.1.8"
#NPM_VERSION="2.1.9"
#NPM_VERSION="2.1.10"
#NPM_VERSION="2.1.11"
#NPM_VERSION="2.1.12"
#NPM_VERSION="2.1.13"
#NPM_VERSION="2.1.14"
#NPM_VERSION="2.1.15"
#NPM_VERSION="2.1.16"
#NPM_VERSION="2.1.17"
#NPM_VERSION="2.1.18"
#NPM_VERSION="2.2.0"
#NPM_VERSION="2.3.0"
#NPM_VERSION="2.4.0"
#NPM_VERSION="2.4.1"
#NPM_VERSION="2.5.0"
#NPM_VERSION="2.5.1"
#NPM_VERSION="2.6.0"
#NPM_VERSION="2.6.1"
#NPM_VERSION="2.7.0"
#NPM_VERSION="2.7.1"
#NPM_VERSION="2.7.2"
#NPM_VERSION="2.7.3"
#NPM_VERSION="2.7.4"
#NPM_VERSION="2.7.5"
#NPM_VERSION="2.7.6"
#NPM_VERSION="2.8.0"
#NPM_VERSION="2.8.1"
#NPM_VERSION="2.8.2"
#NPM_VERSION="2.8.3"
#NPM_VERSION="2.8.4"
#NPM_VERSION="2.9.0"
#NPM_VERSION="2.9.1"
#NPM_VERSION="2.10.0"
#NPM_VERSION="2.10.1"
#NPM_VERSION="2.11.0"
#NPM_VERSION="2.11.1"
#NPM_VERSION="2.11.2"
#NPM_VERSION="2.11.3"
#NPM_VERSION="2.12.0"
NPM_VERSION="3.0.0"
#NPM_VERSION="2.12.1"
#NPM_VERSION="2.13.0"
#NPM_VERSION="3.1.0"
#NPM_VERSION="2.13.1"
#NPM_VERSION="3.1.1"
#NPM_VERSION="3.1.2"
#NPM_VERSION="2.13.2"
#NPM_VERSION="3.1.3"
#NPM_VERSION="2.13.3"
#NPM_VERSION="3.2.0"
#NPM_VERSION="2.13.4"
#NPM_VERSION="3.2.1"
#NPM_VERSION="2.13.5"
#NPM_VERSION="3.2.2"
#NPM_VERSION="2.14.0"
#NPM_VERSION="3.3.0"
#NPM_VERSION="2.14.1"
#NPM_VERSION="2.14.2"
#NPM_VERSION="3.3.1"
#NPM_VERSION="2.14.3"
#NPM_VERSION="3.3.2"
#NPM_VERSION="2.14.4"
#NPM_VERSION="3.3.3"
#NPM_VERSION="2.14.5"
#NPM_VERSION="3.3.4"
#NPM_VERSION="2.14.6"
#NPM_VERSION="3.3.5"
#NPM_VERSION="3.3.6"
#NPM_VERSION="2.14.7"
#NPM_VERSION="2.14.8"
#NPM_VERSION="3.3.7"
#NPM_VERSION="3.3.8"
#NPM_VERSION="3.3.9"
#NPM_VERSION="3.3.10"
#NPM_VERSION="2.14.9"
#NPM_VERSION="3.3.11"
#NPM_VERSION="1.4.29"
#NPM_VERSION="3.3.12"
#NPM_VERSION="2.14.10"
#NPM_VERSION="3.4.0"
#NPM_VERSION="3.4.1"
#NPM_VERSION="2.14.11"
#NPM_VERSION="2.14.12"
#NPM_VERSION="3.5.0"
#NPM_VERSION="3.5.1"
#NPM_VERSION="2.14.13"
#NPM_VERSION="2.14.14"
#NPM_VERSION="3.5.2"
#NPM_VERSION="2.14.15"
#NPM_VERSION="3.5.3"
#NPM_VERSION="3.5.4"
#NPM_VERSION="3.6.0"
#NPM_VERSION="2.14.16"
#NPM_VERSION="2.14.17"
#NPM_VERSION="3.7.0"
#NPM_VERSION="3.7.1"
#NPM_VERSION="3.7.2"
#NPM_VERSION="2.14.18"
#NPM_VERSION="3.7.3"
#NPM_VERSION="2.14.19"
#NPM_VERSION="2.14.20"
#NPM_VERSION="3.7.4"
#NPM_VERSION="3.7.5"
#NPM_VERSION="2.14.21"
#NPM_VERSION="3.8.0"
#NPM_VERSION="2.14.22"
#NPM_VERSION="3.8.1"
#NPM_VERSION="3.8.2"
#NPM_VERSION="2.15.0"
#NPM_VERSION="2.15.1"
#NPM_VERSION="3.8.3"
#NPM_VERSION="2.15.2"
#NPM_VERSION="3.8.4"
#NPM_VERSION="3.8.5"
#NPM_VERSION="3.8.6"
#NPM_VERSION="2.15.3"
#NPM_VERSION="3.8.7"
#NPM_VERSION="2.15.4"
#NPM_VERSION="3.8.8"
#NPM_VERSION="3.8.9"
#NPM_VERSION="2.15.5"
#NPM_VERSION="3.9.0"
#NPM_VERSION="3.9.1"
#NPM_VERSION="2.15.6"
#NPM_VERSION="3.9.2"
#NPM_VERSION="3.9.3"
#NPM_VERSION="3.9.4"
#NPM_VERSION="3.9.5"
#NPM_VERSION="3.9.6"
#NPM_VERSION="3.10.0"
#NPM_VERSION="2.15.7"
#NPM_VERSION="3.10.1"
#NPM_VERSION="2.15.8"
#NPM_VERSION="3.10.2"
#NPM_VERSION="3.10.3"
#NPM_VERSION="3.10.4"
#NPM_VERSION="2.15.9"
#NPM_VERSION="3.10.5"
#NPM_VERSION="3.10.6"
#NPM_VERSION="3.10.7"
#NPM_VERSION="2.15.10"
#NPM_VERSION="3.10.8"
#NPM_VERSION="2.15.11"
#NPM_VERSION="3.10.9"
#NPM_VERSION="4.0.0"
#NPM_VERSION="4.0.1"
#NPM_VERSION="4.0.2"
#NPM_VERSION="3.10.10"
#NPM_VERSION="4.0.3"
#NPM_VERSION="4.0.5"
#NPM_VERSION="4.1.0"
#NPM_VERSION="4.1.1"

IMAGE="mhart/alpine-node:$NODE_VERSION"
DOCKERFILE="FROM "$IMAGE"\nRUN npm install -g npm@$NPM_VERSION"
TAG="nodecontainer/node$NODE_VERSION-npm$NPM_VERSION"

#NPM_INSTALL="npm install -g npm@$NPM_VERSION && node --version && npm --version"

# Setup volume mounts for compose config and context
if [ "$(pwd)" != '/' ]; then
    VOLUMES="-v $(pwd):$(pwd)"
fi

# Only allocate tty if we detect one
if [ -t 1 ]; then
    DOCKER_RUN_OPTIONS="-t"
fi
if [ -t 0 ]; then
    DOCKER_RUN_OPTIONS="$DOCKER_RUN_OPTIONS -i"
fi

# Build the docker image based on node/npm version (will cache)
echo -e "${DOCKERFILE}" | docker build -t $TAG -

exec docker run --rm \
 $DOCKER_RUN_OPTIONS \
 $VOLUMES \
 -w "$(pwd)" \
 $TAG \
   /bin/sh -c "$@"


#exec docker run --rm \
#  $DOCKER_RUN_OPTIONS \
#  $VOLUMES \
#  -w "$(pwd)" \
#  $IMAGE \
#    /bin/sh -c "$NPM_INSTALL && $@"
